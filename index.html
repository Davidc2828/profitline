
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Turnos Profitline</title>
  <style>
    body {
      background-color: #000;
      color: white;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .btn {
      background-color: #c8102e;
      color: white;
      padding: 10px;
      border: none;
      cursor: pointer;
      margin: 5px;
    }
    table, th, td {
      border: 1px solid white;
      border-collapse: collapse;
      padding: 8px;
    }
    table {
      width: 100%;
      margin-top: 20px;
    }
    th {
      background-color: #c8102e;
    }
  </style>
</head>
<body>
  <h1>Registro de Turnos - Profitline</h1>
  <input type="text" id="nombre" placeholder="Nombre del Analista">
  <button class="btn" onclick="registrar('Ingreso')">Ingreso</button>
  <button class="btn" onclick="registrar('Inicio Break')">Inicio Break</button>
  <button class="btn" onclick="registrar('Fin Break')">Fin Break</button>
  <button class="btn" onclick="registrar('Inicio Almuerzo')">Inicio Almuerzo</button>
  <button class="btn" onclick="registrar('Fin Almuerzo')">Fin Almuerzo</button>
  <button class="btn" onclick="registrar('Salida')">Salida</button>
  <button class="btn" onclick="guardar()">Guardar en la nube</button>

  <table id="tablaRegistros">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Tipo</th>
        <th>Fecha</th>
        <th>Hora</th>
        <th>Alerta</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const registros = [];
    const tiempos = {};

    function registrar(tipo) {
      const nombre = document.getElementById('nombre').value.trim();
      if (!nombre) return alert('Ingrese nombre');

      const fecha = new Date();
      const hora = fecha.toLocaleTimeString();
      const fechaStr = fecha.toLocaleDateString();
      let alerta = '';

      const key = nombre + '_' + fechaStr;
      if (!tiempos[key]) tiempos[key] = {};
      tiempos[key][tipo] = fecha;

      if (tipo === 'Ingreso' && fecha.getHours() >= 8) alerta = 'Ingreso Tarde';
      if (tipo === 'Salida' && fecha.getHours() < 18) alerta = 'Salida Temprano';
      if (tipo === 'Fin Break' && tiempos[key]['Inicio Break']) {
        const diff = (fecha - tiempos[key]['Inicio Break']) / 60000;
        if (diff > 15) alerta = 'Break mayor a 15 minutos';
      }
      if (tipo === 'Fin Almuerzo' && tiempos[key]['Inicio Almuerzo']) {
        const diff = (fecha - tiempos[key]['Inicio Almuerzo']) / 60000;
        if (diff > 60) alerta = 'Almuerzo mayor a 1 hora';
      }

      registros.push({ nombre, tipo, fecha: fechaStr, hora, alerta });
      actualizarTabla();
    }

    function actualizarTabla() {
      const tbody = document.querySelector('#tablaRegistros tbody');
      tbody.innerHTML = '';
      registros.forEach(r => {
        tbody.innerHTML += `<tr>
          <td>${r.nombre}</td>
          <td>${r.tipo}</td>
          <td>${r.fecha}</td>
          <td>${r.hora}</td>
          <td>${r.alerta}</td>
        </tr>`;
      });
    }

    function guardar() {
      fetch("https://script.google.com/macros/s/AKfycbyjq_4aeTJxEVunwKxwkm2J6nYA4PPXqOciooY8afztvdBzHTpGrK43AlU5-JPW5Do5/exec", {
        method: "POST",
        headers: {
          "Content-Type": "text/plain;charset=utf-8"
        },
        body: JSON.stringify(registros)
      })
      .then(res => res.json())
      .then(data => {
        alert("Guardado: " + data.status);
        registros.length = 0;
        actualizarTabla();
      })
      .catch(err => {
        console.error(err);
        alert("Error de conexi√≥n");
      });
    }
  </script>
</body>
</html>
